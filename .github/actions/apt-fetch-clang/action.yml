name: Fetch Clang toolchain on Linux

inputs:
  llvm-ver:
    required: false
    default: 15
runs:
  using: composite

  steps:
    - run: |
        curl -s https://apt.llvm.org/llvm.sh | sudo bash -s ${{ inputs.llvm-ver }};
        sudo apt-get update;
        sudo apt-get upgrade;
      shell: bash

    - uses: awalsh128/cache-apt-pkgs-action@latest
      with:
        packages: clang-tidy-${{ inputs.llvm-ver }} libc++-${{ inputs.llvm-ver }}-dev libc++abi-${{ inputs.llvm-ver }}-dev
        version: ${{ inputs.llvm-ver }}

    - run: |
        curl -s https://apt.llvm.org/llvm.sh | sudo bash -s ${{ inputs.llvm-ver }};
        sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/clang-tidy clang-tidy /usr/bin/clang-tidy-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/llvm-cov llvm-cov /usr/bin/llvm-cov-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/llvm-profdata llvm-profdata /usr/bin/llvm-profdata-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/ld.lld ld.lld /usr/bin/ld.lld-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/cc cc /usr/bin/clang-${{ inputs.llvm-ver }} 1000;
        sudo update-alternatives --install /usr/bin/c++ c++ /usr/bin/clang++-${{ inputs.llvm-ver }} 1000;
      shell: bash
